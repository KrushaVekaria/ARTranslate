<!DOCTYPE html>

<html lang = "en">

	<head>
	
		<meta charset = "utf-8">
		<title>Video in Real Time</title>
		<link rel = "stylesheet" href = "VideoTest.CSS">
		<meta name = "author" content = "Krusha Vekaria">
		
	</head>

	<body>
	
		<video id="videoScreen" width="640" height="480" autoplay></video>
		<button id="snap">Snap Photo</button>
		<canvas id="canvas" width="640" height="480"></canvas>

    	
    	<script>
    		//MediaStreamTrack.getSources(gotSources);
    		
    		// Grab elements, create settings, etc.
    		//var video = document.getElementById('videoScreen');
    		
    		//var constraints = {	
    		//	video: {
    		//		optional: [{sourceId: videoSource}]
    		//	}
    		//};
    		//navigator.getUserMedia(constraints, successCallback, errorCallback);

    		// Get access to the camera!
    		if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
    			// Not adding `{ audio: true }` since we only want video now
    			navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
    					video.src = window.URL.createObjectURL(stream);
    					video.play();
    			}).catch(function(err){
    				console.log('Error >>>', err)
    			});
    		}
    		
    		// Elements for taking the snapshot
    		// var canvas = document.getElementById('canvas');
    		// var context = canvas.getContext('2d');
    		// var video = document.getElementById('videoScreen');

    		// // Trigger photo take
    		// document.getElementById("snap").addEventListener("click", function() {
    		// 		context.drawImage(video, 0, 0, 640, 480);
    		// 		context.drawImage(video, 0, 0, 640, 480);
    		// });
    		
    		// var videoElement = document.querySelector('video');
    		//  var audioSelect = document.querySelector('select#audioSource');
    		//  var videoSelect = document.querySelector('select#videoSource');

    		// navigator.mediaDevices.enumerateDevices()
    		// .then(gotDevices).then(getStream).catch(handleError);

    		// audioSelect.onchange = getStream;
    		// videoSelect.onchange = getStream;

    		function gotDevices(deviceInfos) {
    			console.log('DEVICE INFO >>>>>>> ', deviceInfos);
    			for (var i = 0; i !== deviceInfos.length; ++i) {
    				var deviceInfo = deviceInfos[i];
    				var option = document.createElement('option');
    				option.value = deviceInfo.deviceId;
    				if (deviceInfo.kind === 'audioinput') {
    					option.text = deviceInfo.label ||
    					'microphone ' + (audioSelect.length + 1);
    					audioSelect.appendChild(option);
    				} else if (deviceInfo.kind === 'videoinput') {
						option.text = deviceInfo.label || 'camera ' +
						(videoSelect.length + 1);
						videoSelect.appendChild(option);
					} else {
						console.log('Found one other kind of source/device: ', deviceInfo);
					}
				}
			}

			function getStream() {
				if (window.stream) {
					window.stream.getTracks().forEach(function(track) {
					track.stop();
				});
			}

			// var constraints = {
			// 	audio: {
			// 		deviceId: {exact: audioSelect.value}
			// 	},
			// 	video: {
			// 		deviceId: {exact: videoSelect.value}
			// 	}
			// };

			// navigator.mediaDevices.getUserMedia(constraints).
			// then(gotStream).catch(handleError);
			// }

			function gotStream(stream) {
				window.stream = stream; // make stream available to console
				videoElement.srcObject = stream;
			}

			function handleError(error) {
				console.log('Error: ', error);
			}

    	</script>
    	
    </body>
    
</html>
